## 动态链接

将链接的步骤推迟到运行。

动态链接库（假设叫libd.so）在磁盘和内存中都只保留一份。所以动态链接库的地址无法在链接的时候确定，只能在运行的时候，查找这个动态链接库的地址，重定向上去（因为此时libd.so已经在内存中了，他已经有地址了，在链接的时候是无法确定的）。

动态链接还有一个好处就是：程序运行的时候可以动态选择加载不同的程序模块，插件就是这样做的。

动态链接需要动态链接器的帮助将未决议的符号绑定到动态链接器上，并重定向。

每个可执行文件都有一个动态链接器被映射到文件的地址空间了。

##### 动态链接的方式

（1）按照代码无关方式（PIC）

（2）装载时重定位

##### 地址无关的代码

对于固定地址程序的处理，例如数据和方法

使用GOT（全局偏移表）记录，间接引用(还是加了一个中间层)

装载时重定向



#### 动态链接结构

##### .interp段

存放动态链接库地址

```c
  objdump -s /usr/bin/ls  // 得到动态链接库的路径,可以对照ASCII码翻译得到

/usr/bin/ls:     file format elf64-x86-64

Contents of section .interp:
 400238 2f6c6962 36342f6c 642d6c69 6e75782d  /lib64/ld-linux-
 400248 7838362d 36342e73 6f2e3200           x86-64.so.2.
...
```

##### .dynamic段

包含了动态链接库需要的一些信息（依赖的共享对象，动态链接符号表位置，动态链接重定向表位置，）

```c
// 
readelf -d /usr/local/python3/lib/python3.8/lib-dynload/xxlimited.cpython-38-x86_64-linux-gnu.so
```

##### .symtab段（符号表）

保存了所有关于此目标文件的符号定义与引用。

##### .dynsym段（动态符号表）

只保存了动态链接相关的符号（此表需要一些其他辅助的表）

##### 动态链接重定向表

不同的重定位类型表示重定向时有不同的地址计算方法。